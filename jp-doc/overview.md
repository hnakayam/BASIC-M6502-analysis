# m6502.asm（BASIC M6502 8K VER 1.1）の処理内容まとめ

このファイルは、**Microsoftによる6502プロセッサ向けBASICインタープリタ（8K版）**のアセンブリソースです。主な処理内容や構成要素は以下の通りです。

---

## 1. **初期設定とコンフィグレーション**
- 複数のプラットフォーム（Apple, Commodore, OSI, KIM, PDP-10等）に対応した切替スイッチやマクロ定義が多数含まれています。
- メモリ配置やI/Oアドレス、バッファサイズ、ROM/RAMの位置を条件分岐により設定。
- システムごとの細かな挙動や初期値もここで決定されます。

---

## 2. **主要なラベル・データ構造の定義**
- **ページゼロ（ゼロページ）**に変数領域やフラグ領域、ポインタ等のRAM管理用データを配置。
  - 例：`CHARAC`（区切り文字）、`COUNT`（汎用カウンタ）、`DIMFLG`（DIM処理用フラグ）、`VALTYP`（型情報）、`TXTTAB`（プログラムテキスト開始位置）等。
- **スタックやバッファ、文字列管理領域**なども詳細に配置。

---

## 3. **処理の流れ・アルゴリズムの説明**
- **プログラム行・変数・配列・文字列などの管理方法**を詳細に解説するコメントが充実。
- **式評価（FRMEVL/EVAL）**：
  - 数式や関数、変数の解析と評価を行うアルゴリズムを説明。
  - 演算子の優先順位管理・スタック利用。
- **文字列処理とガベージコレクション**：
  - 文字列領域の確保・解放、ガベージコレクションによる領域整理の手順を詳細記述。
- **エラー処理**：
  - エラー発生時のメッセージ表示、スタック初期化、プログラムコンテキストのリセット等。

---

## 4. **各種サブルーチン・マクロ定義**
- 6502アセンブリの命令を簡単に使えるマクロが豊富（例：`LDWD`, `STWD`, `CLR`, `INCW`等）。
- プラットフォーム依存の処理や条件分岐もマクロを用いて柔軟に対応。

---

## 5. **RAM/ROMコード・主要なルーチン**
- **CHRGET**：テキストポインタから次の文字を取得し、解析に用いる基本ルーチン。
- **各種初期化ルーチン（INIT等）**や、プログラム実行のメインチェックポイント（NEWSTT等）も定義。

---

## 6. **ディスパッチテーブルと定数群**
- BASICの予約語や演算子の「クランチリスト」や、エラーコード／関数ジャンプテーブルの配置。
- これにより高速な命令分岐・実行が可能。

---

## 7. **コメントによるバグ修正履歴・設計方針**
- 1976年～78年のバグ修正・機能改善履歴が詳細に記載。
- BASICインタープリタの設計思想や、6502向けの工夫も含む。

---

Created using GitHub Copilot with gpt 4.1 engine selected.
## **まとめ**
このファイルは、6502用BASICインタープリタの**初期化・メモリ管理・各種処理ルーチン・文字列／数式評価・エラー処理・ディスパッチテーブル等の全体構造**を定義した、主要なアセンブリソースです。**各種マクロと条件分岐による柔軟な移植性・効率的なメモリ利用・高速なコマンド解析**を中心に設計されています。
